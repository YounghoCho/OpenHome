<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--  
 * Application java
 * @Author : Youngho Jo
 -->	
<mapper namespace="traffic">
	
	<select id="getTrafficData" resultType="com.worksmobile.openhome.model.TrafficMemo">
		SELECT tm_type as tmType, tm_content_length as tmContentLength, tm_date as tmDate
		FROM traffic_memo
	</select>
	<select id="getTrafficCount" resultType="int">
		SELECT count(tm_num) as countAll
		FROM traffic_memo
	</select>
	
	<insert id="insertContentLength" parameterType="com.worksmobile.openhome.model.Traffic">
		INSERT
		INTO
			traffic(trafficContentLength, trafficKind, trafficDate)
		VALUES 
			( #{trafficContentLength}, #{trafficKind}, now() )
	</insert>	
	
	<insert id="copyTrafficData" parameterType="com.worksmobile.openhome.model.TrafficMemo">
		INSERT
		INTO
			traffic_memo(tm_type, tm_content_length, tm_date)
		VALUES 
			(#{trafficKind}, (SELECT SUM(trafficContentLength) FROM traffic where trafficKind = #{trafficKind}), now())			
	</insert>		
	
	<delete id="clearTrafficData">
		DELETE
		FROM
			traffic
	</delete>
</mapper>